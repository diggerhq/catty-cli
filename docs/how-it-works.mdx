---
title: "How It Works"
description: "Understand the architecture behind Catty"
---

Catty connects your local terminal to Claude Code running in isolated cloud machines. Here's how all the pieces fit together.

## Architecture

```
┌─────────────┐     ┌─────────────┐     ┌──────────────┐
│  catty CLI  │────▶│  Catty API  │────▶│   Session    │
│   (local)   │     │   (cloud)   │     │   Machine    │
└─────────────┘     └─────────────┘     └──────────────┘
      │                   │                    │
      │                   │                    ▼
      │                   │              ┌──────────────┐
      │                   │              │ Claude Code  │
      │                   │              └──────────────┘
      │                   │                    │
      └───────────────────┴────────────────────┘
                    WebSocket
                 (PTY streaming)
```

## Components

<AccordionGroup>
  <Accordion title="Catty CLI" icon="terminal">
    The command-line tool you install via npm. It handles:
    - User authentication
    - Creating and managing sessions
    - Uploading your workspace
    - WebSocket connection for terminal streaming
    - Real-time sync-back of file changes
    - Encrypted secrets management
  </Accordion>

  <Accordion title="Catty API" icon="server">
    The hosted API server. It handles:
    - User authentication and session management
    - Provisioning cloud machines
    - Presigned URLs for workspace downloads
    - Billing and quota management
  </Accordion>

  <Accordion title="Session Machine" icon="microchip">
    The runtime environment for each session. It handles:
    - Receiving workspace uploads
    - Running Claude Code in a PTY
    - WebSocket relay for terminal I/O
    - File watching for sync-back
    - Periodic workspace saves to cloud storage
  </Accordion>

  <Accordion title="Cloud Storage" icon="cloud">
    Secure storage for workspace persistence:
    - Receives workspace snapshots every 30 seconds
    - Enables downloads via presigned URLs
    - Survives session termination
  </Accordion>
</AccordionGroup>

## Data Flow

### Session Creation

1. `catty new` calls the API
2. API provisions a cloud machine
3. Machine starts and reports ready
4. CLI zips your workspace (respecting `.gitignore`)
5. Workspace uploads to session machine
6. WebSocket connection established
7. Claude Code spawns in a PTY
8. Terminal I/O streams bidirectionally

### File Sync-Back

1. Claude modifies a file in `/workspace`
2. File watcher detects the change
3. Change sent over WebSocket as JSON message
4. CLI validates path (security check)
5. File written to your local directory

### Cloud Persistence

1. Session saves workspace every 30 seconds
2. Tarball uploaded to cloud storage
3. When you run `catty download`:
   - API generates presigned URL
   - CLI downloads directly from cloud storage
   - Extracts to your local directory

## Security

| Aspect | Implementation |
|--------|----------------|
| Authentication | OAuth via browser, tokens stored locally |
| Secrets | AES-256-GCM encrypted, machine-bound |
| Transport | HTTPS for API, WSS for WebSocket |
| Isolation | Each session runs in its own machine |
| File access | Sessions can only access `/workspace` |
